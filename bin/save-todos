#!/usr/bin/env sh
set -e
OS="$(uname -s | tr '[:upper:]' '[:lower:]')"
ARCH="$(uname -m)"
case "$ARCH" in
  x86_64)  ARCH="amd64" ;;
  aarch64) ARCH="arm64" ;;
  arm64)   ARCH="arm64" ;;
  *)       echo "Unsupported architecture: $ARCH" >&2; exit 1 ;;
esac
case "$OS" in
  darwin)  OS="darwin" ;;
  linux)   OS="linux" ;;
  mingw*|msys*|cygwin*) OS="windows" ;;
  *)       echo "Unsupported OS: $OS" >&2; exit 1 ;;
esac
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
BINARY="${SCRIPT_DIR}/save-todos-${OS}-${ARCH}"
[ "$OS" = "windows" ] && BINARY="${BINARY}.exe"
if [ ! -x "$BINARY" ]; then
  echo "Binary not found: $BINARY" >&2
  echo "Platform: ${OS}/${ARCH}" >&2
  exit 1
fi
exec "$BINARY" "$@"
